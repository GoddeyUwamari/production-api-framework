apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: production-api-staging

# Reference to base configuration
bases:
  - ../base

# Namespace for staging environment
namespace: production-api-staging

# Staging-specific name prefix
namePrefix: staging-

# Staging-specific labels
commonLabels:
  environment: staging
  tier: backend

# Staging-specific annotations
commonAnnotations:
  environment: staging
  version: "1.0.0-staging"

# Images - use specific tag for staging
images:
  - name: ghcr.io/goddeyuwamari/production-api-framework
    newTag: develop

# Patches to override base configuration
patchesStrategicMerge:
  - deployment-patch.yaml
  - configmap-patch.yaml
  - ingress-patch.yaml

# Resource adjustments for staging
replicas:
  - name: production-api
    count: 2

# ConfigMap additions/overrides
configMapGenerator:
  - name: production-api-config
    behavior: merge
    literals:
      - NODE_ENV=staging
      - LOG_LEVEL=debug
      - ENABLE_SWAGGER=true
      - ENABLE_METRICS=true

# =============================================================================
# Deploy to Staging:
# =============================================================================
#
# kubectl apply -k infrastructure/kubernetes/staging/
#
# OR with kustomize CLI:
# kustomize build infrastructure/kubernetes/staging/ | kubectl apply -f -
#
# =============================================================================
